import{M as W,b_ as $,al as O,l as f,R as J,ca as L,bZ as z,c2 as H,an as X,P as Z,aI as G,aJ as K,e as u,bf as P,c4 as q,cb as F,cd as Q,bS as Y,aq as ee,d1 as te,cv as x,_ as A,b as ae,d as oe,c as S,o as T,a as m,u as v,w as g,i as k,B as ne,h as U,aH as se,F as le,n as E,a0 as re,a1 as ie,ab as ce,ac as D,af as j}from"./index-D4QMGDdD.js";import"./el-tooltip-l0sNRNKZ.js";const[ue,B]=O("notice-bar"),de={text:String,mode:String,color:String,delay:$(1),speed:$(60),leftIcon:String,wrapable:Boolean,background:String,scrollable:{type:Boolean,default:null}};var fe=W({name:ue,props:de,emits:["close","replay"],setup(e,{emit:s,slots:l}){let a=0,n=0,r;const p=f(),d=f(),t=J({show:!0,offset:0,duration:0}),_=()=>{if(l["left-icon"])return l["left-icon"]();if(e.leftIcon)return u(P,{class:B("left-icon"),name:e.leftIcon},null)},y=()=>{if(e.mode==="closeable")return"cross";if(e.mode==="link")return"arrow"},R=i=>{e.mode==="closeable"&&(t.show=!1,s("close",i))},C=()=>{if(l["right-icon"])return l["right-icon"]();const i=y();if(i)return u(P,{name:i,class:B("right-icon"),onClick:R},null)},N=()=>{t.offset=a,t.duration=0,Y(()=>{F(()=>{t.offset=-n,t.duration=(n+a)/+e.speed,s("replay")})})},M=()=>{const i=e.scrollable===!1&&!e.wrapable,h={transform:t.offset?`translateX(${t.offset}px)`:"",transitionDuration:`${t.duration}s`};return u("div",{ref:p,role:"marquee",class:B("wrap")},[u("div",{ref:d,style:h,class:[B("content"),{"van-ellipsis":i}],onTransitionend:N},[l.default?l.default():e.text])])},b=()=>{const{delay:i,speed:h,scrollable:I}=e,o=Q(i)?+i*1e3:0;a=0,n=0,t.offset=0,t.duration=0,clearTimeout(r),r=setTimeout(()=>{if(!p.value||!d.value||I===!1)return;const c=q(p).width,w=q(d).width;(I||w>c)&&F(()=>{a=c,n=w,t.offset=-n,t.duration=n/+h})},o)};return L(b),z(b),H("pageshow",b),X({reset:b}),Z(()=>[e.text,e.scrollable],b),()=>{const{color:i,wrapable:h,background:I}=e;return G(u("div",{role:"alert",class:B({wrapable:h}),style:{color:i,background:I}},[_(),M(),C()]),[[K,t.show]])}}});const ke=ee(fe),V=te.create({});V.interceptors.request.use(e=>(e.headers["Content-Type"]="multipart/form-data;charset=UTF-8",e),e=>Promise.reject(e));V.interceptors.response.use(e=>{let s=e.data;return e.config.responseType==="blob"||typeof s=="string"&&(s=s&&JSON.parse(s)),s},e=>Promise.reject(e));const Re={video:{uploadAllVideos:e=>V.post("/api/upload",e),uploadVideo:e=>V.post("/api/infer",e),getAllVideos:e=>x.get("/api/list",e),getSelectVideo:e=>x.get("/api/getVideo",e),updateVideoTag:e=>x.put("/api/updateTag",e),deleteVideo:e=>x.delete("/api/deleteVideo",e),deleteVideoTag:e=>x.put("/api/deleteTag",null,e)},audio:{toText:e=>V.post("/api/audio2text",e)}},pe={key:0,style:{display:"flex","justify-content":"center",gap:"20vw","margin-top":"2vh"}},ve={key:1,class:"control-panel"},me={__name:"ControlPanel",emits:["add-video","start-recording","upload"],setup(e,{emit:s}){const l=f(null),a=s,n=ae(()=>oe()),r=()=>{l.value.click()},p=d=>{const t=d.target.files[0];if(t){if(!t.type.includes("video")){E("请选择视频文件");return}a("add-video",t),l.value.value=null}};return(d,t)=>{const _=ne,y=U,R=se;return T(),S(le,null,[v(n)?(T(),S("div",pe,[u(_,{type:"primary",onClick:r},{default:g(()=>t[3]||(t[3]=[m("i",{class:"iconfont icon-shangchuan"},null,-1),k(" 视频选择 ")])),_:1}),u(_,{type:"warning",onClick:t[0]||(t[0]=C=>a("upload"))},{default:g(()=>t[4]||(t[4]=[m("i",{class:"iconfont icon-shangchuan1"},null,-1),k(" 一键上传 ")])),_:1})])):(T(),S("div",ve,[u(y,{type:"primary",onClick:r},{default:g(()=>t[5]||(t[5]=[m("i",{class:"iconfont icon-shangchuan"},null,-1),k(" 选择本地视频 ")])),_:1}),u(R,{content:"将打开本机摄像头进行录制"},{default:g(()=>[u(y,{type:"success",onClick:t[1]||(t[1]=C=>a("start-recording"))},{default:g(()=>t[6]||(t[6]=[m("i",{class:"iconfont icon-luzhi"},null,-1),k(" 摄像头录制 ")])),_:1})]),_:1}),u(y,{type:"warning",onClick:t[2]||(t[2]=C=>a("upload"))},{default:g(()=>t[7]||(t[7]=[m("i",{class:"iconfont icon-shangchuan1"},null,-1),k(" 一键上传 ")])),_:1})])),m("input",{type:"file",ref_key:"fileInput",ref:l,hidden:"",accept:"video/*",onChange:p},null,544)],64)}}},Ce=A(me,[["__scopeId","data-v-2226e665"]]),ge={class:"camera-recorder"},_e={class:"controls"},ye={key:1},be={__name:"CameraRecorder",emits:["record-complete"],setup(e,{emit:s}){const l=f(null),a=f(null),n=f(!1),r=f(!1),p=f(0),d=f(null),t=f([]),_=f(!1),y=s;re(()=>R()),ie(()=>C());const R=()=>{navigator.mediaDevices.getUserMedia({video:!0}).then(o=>{l.value.srcObject=o,a.value=new MediaRecorder(o),a.value.ondataavailable=c=>t.value.push(c.data),a.value.onstop=()=>{const c=new Blob(t.value,{type:"video/x-msvideo"});y("record-complete",c),t.value=[]},_.value=!0}).catch(o=>{o.name==="NotAllowedError"?(console.error("用户拒绝了权限请求"),E("用户拒绝了权限请求")):o.name==="NotFoundError"?(console.error("未找到摄像头"),E("未找到摄像头")):(console.error("无法访问摄像头:",o.message),E("无法访问摄像头:",o.message))})},C=()=>{var o;(o=a.value)!=null&&o.stream&&a.value.stream.getTracks().forEach(c=>c.stop())},N=()=>{n.value?r.value?i():b():M()},M=()=>{var o;_.value||R(),(o=a.value)!=null&&o.stream&&(a.value.start(),n.value=!0,r.value=!1,d.value=setInterval(()=>p.value++,1e3))},b=()=>{a.value&&(a.value.pause(),r.value=!0,clearInterval(d.value))},i=()=>{a.value&&(a.value.resume(),r.value=!1,d.value=setInterval(()=>p.value++,1e3))},h=()=>{a.value&&(a.value.stop(),clearInterval(d.value),n.value=!1,r.value=!1,p.value=0)},I=o=>{const c=Math.floor(o/60),w=o%60;return`${c}:${w.toString().padStart(2,"0")}`};return(o,c)=>{const w=U;return T(),S("div",ge,[m("video",{ref_key:"videoElement",ref:l,autoplay:"",muted:""},null,512),m("div",_e,[u(w,{type:v(n)&&v(r)?"primary":"danger",onClick:N},{default:g(()=>[k(j(v(n)?v(r)?"继续录制":"暂停录制":"开始录制"),1)]),_:1},8,["type"]),v(n)?(T(),ce(w,{key:0,type:"danger",onClick:h},{default:g(()=>c[0]||(c[0]=[k(" 停止录制 ")])),_:1})):D("",!0),v(n)?(T(),S("span",ye,"  "+j(I(v(p))),1)):D("",!0)])])}}},Ie=A(be,[["__scopeId","data-v-fec868db"]]);export{Ce as C,ke as N,Ie as a,Re as f};
