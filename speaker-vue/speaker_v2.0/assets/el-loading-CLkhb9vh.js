import{l as y,D as G,c_ as re,C as H,K as ie,c$ as ce,az as N,w as C,aB as Z,e as x,aC as Q,ao as ue,at as O,al as de,X as ee,s as te,d0 as S,ar as z,aF as ne,aW as fe,d1 as ve,bK as q,ad as me,bX as ge,bJ as pe,bP as be,af as _e,I as ye,b2 as U,bR as W,bY as K,b_ as xe,bD as ke,ai as Ce,d2 as he,cx as L,_ as oe,b as we,d as Re,c as P,o as B,a as h,u as I,i as E,B as Ie,a3 as ae,a4 as F,h as se,aA as Ee,F as Te,n as w,T as Ae,U as Be,a7 as X}from"./index-8BGEKXL5.js";import"./el-tooltip-l0sNRNKZ.js";function Ne(e,t){let n;const o=y(!1),a=G({...e,originalPosition:"",originalOverflow:"",visible:!1});function s(l){a.text=l}function u(){const l=a.parent,g=m.ns;if(!l.vLoadingAddClassList){let v=l.getAttribute("loading-number");v=Number.parseInt(v)-1,v?l.setAttribute("loading-number",v.toString()):(O(l,g.bm("parent","relative")),l.removeAttribute("loading-number")),O(l,g.bm("parent","hidden"))}d(),b.unmount()}function d(){var l,g;(g=(l=m.$el)==null?void 0:l.parentNode)==null||g.removeChild(m.$el)}function i(){var l;e.beforeClose&&!e.beforeClose()||(o.value=!0,clearTimeout(n),n=setTimeout(f,400),a.visible=!1,(l=e.closed)==null||l.call(e))}function f(){if(!o.value)return;const l=a.parent;o.value=!1,l.vLoadingAddClassList=void 0,u()}const r=H({name:"ElLoading",setup(l,{expose:g}){const{ns:v,zIndex:p}=ce("loading");return g({ns:v,zIndex:p}),()=>{const k=a.spinner||a.svg,R=N("svg",{class:"circular",viewBox:a.svgViewBox?a.svgViewBox:"0 0 50 50",...k?{innerHTML:k}:{}},[N("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),c=a.text?N("p",{class:v.b("text")},[a.text]):void 0;return N(ue,{name:v.b("fade"),onAfterLeave:f},{default:C(()=>[Z(x("div",{style:{backgroundColor:a.background||""},class:[v.b("mask"),a.customClass,a.fullscreen?"is-fullscreen":""]},[N("div",{class:v.b("spinner")},[R,c])]),[[Q,a.visible]])])})}}}),b=re(r);Object.assign(b._context,t??{});const m=b.mount(document.createElement("div"));return{...ie(a),setText:s,removeElLoadingChild:d,close:i,handleAfterLeave:f,vm:m,get $el(){return m.$el}}}let M;const j=function(e={}){if(!de)return;const t=Se(e);if(t.fullscreen&&M)return M;const n=Ne({...t,closed:()=>{var a;(a=t.closed)==null||a.call(t),t.fullscreen&&(M=void 0)}},j._context);Le(t,t.parent,n),J(t,t.parent,n),t.parent.vLoadingAddClassList=()=>J(t,t.parent,n);let o=t.parent.getAttribute("loading-number");return o?o=`${Number.parseInt(o)+1}`:o="1",t.parent.setAttribute("loading-number",o),t.parent.appendChild(n.$el),ee(()=>n.visible.value=t.visible),t.fullscreen&&(M=n),n},Se=e=>{var t,n,o,a;let s;return te(e.target)?s=(t=document.querySelector(e.target))!=null?t:document.body:s=e.target||document.body,{parent:s===document.body||e.body?document.body:s,background:e.background||"",svg:e.svg||"",svgViewBox:e.svgViewBox||"",spinner:e.spinner||!1,text:e.text||"",fullscreen:s===document.body&&((n=e.fullscreen)!=null?n:!0),lock:(o=e.lock)!=null?o:!1,customClass:e.customClass||"",visible:(a=e.visible)!=null?a:!0,beforeClose:e.beforeClose,closed:e.closed,target:s}},Le=async(e,t,n)=>{const{nextZIndex:o}=n.vm.zIndex||n.vm._.exposed.zIndex,a={};if(e.fullscreen)n.originalPosition.value=S(document.body,"position"),n.originalOverflow.value=S(document.body,"overflow"),a.zIndex=o();else if(e.parent===document.body){n.originalPosition.value=S(document.body,"position"),await ee();for(const s of["top","left"]){const u=s==="top"?"scrollTop":"scrollLeft";a[s]=`${e.target.getBoundingClientRect()[s]+document.body[u]+document.documentElement[u]-Number.parseInt(S(document.body,`margin-${s}`),10)}px`}for(const s of["height","width"])a[s]=`${e.target.getBoundingClientRect()[s]}px`}else n.originalPosition.value=S(t,"position");for(const[s,u]of Object.entries(a))n.$el.style[s]=u},J=(e,t,n)=>{const o=n.vm.ns||n.vm._.exposed.ns;["absolute","fixed","sticky"].includes(n.originalPosition.value)?O(t,o.bm("parent","relative")):z(t,o.bm("parent","relative")),e.fullscreen&&e.lock?z(t,o.bm("parent","hidden")):O(t,o.bm("parent","hidden"))};j._context=null;const $=Symbol("ElLoading"),A=e=>`element-loading-${ve(e)}`,Y=(e,t)=>{var n,o,a,s;const u=t.instance,d=l=>ne(t.value)?t.value[l]:void 0,i=l=>{const g=te(l)&&(u==null?void 0:u[l])||l;return y(g)},f=l=>i(d(l)||e.getAttribute(A(l))),r=(n=d("fullscreen"))!=null?n:t.modifiers.fullscreen,b={text:f("text"),svg:f("svg"),svgViewBox:f("svgViewBox"),spinner:f("spinner"),background:f("background"),customClass:f("customClass"),fullscreen:r,target:(o=d("target"))!=null?o:r?void 0:e,body:(a=d("body"))!=null?a:t.modifiers.body,lock:(s=d("lock"))!=null?s:t.modifiers.lock},m=j(b);m._context=le._context,e[$]={options:b,instance:m}},Ve=(e,t)=>{for(const n of Object.keys(e))fe(e[n])&&(e[n].value=t[n])},le={mounted(e,t){t.value&&Y(e,t)},updated(e,t){const n=e[$];if(!t.value){n==null||n.instance.close(),e[$]=null;return}n?Ve(n.options,ne(t.value)?t.value:{text:e.getAttribute(A("text")),svg:e.getAttribute(A("svg")),svgViewBox:e.getAttribute(A("svgViewBox")),spinner:e.getAttribute(A("spinner")),background:e.getAttribute(A("background")),customClass:e.getAttribute(A("customClass"))}):Y(e,t)},unmounted(e){var t;(t=e[$])==null||t.instance.close(),e[$]=null}};le._context=null;const[$e,V]=me("notice-bar"),Pe={text:String,mode:String,color:String,delay:q(1),speed:q(60),leftIcon:String,wrapable:Boolean,background:String,scrollable:{type:Boolean,default:null}};var De=H({name:$e,props:Pe,emits:["close","replay"],setup(e,{emit:t,slots:n}){let o=0,a=0,s;const u=y(),d=y(),i=G({show:!0,offset:0,duration:0}),f=()=>{if(n["left-icon"])return n["left-icon"]();if(e.leftIcon)return x(U,{class:V("left-icon"),name:e.leftIcon},null)},r=()=>{if(e.mode==="closeable")return"cross";if(e.mode==="link")return"arrow"},b=p=>{e.mode==="closeable"&&(i.show=!1,t("close",p))},m=()=>{if(n["right-icon"])return n["right-icon"]();const p=r();if(p)return x(U,{name:p,class:V("right-icon"),onClick:b},null)},l=()=>{i.offset=o,i.duration=0,ke(()=>{K(()=>{i.offset=-a,i.duration=(a+o)/+e.speed,t("replay")})})},g=()=>{const p=e.scrollable===!1&&!e.wrapable,k={transform:i.offset?`translateX(${i.offset}px)`:"",transitionDuration:`${i.duration}s`};return x("div",{ref:u,role:"marquee",class:V("wrap")},[x("div",{ref:d,style:k,class:[V("content"),{"van-ellipsis":p}],onTransitionend:l},[n.default?n.default():e.text])])},v=()=>{const{delay:p,speed:k,scrollable:R}=e,c=xe(p)?+p*1e3:0;o=0,a=0,i.offset=0,i.duration=0,clearTimeout(s),s=setTimeout(()=>{if(!u.value||!d.value||R===!1)return;const _=W(u).width,T=W(d).width;(R||T>_)&&K(()=>{o=_,a=T,i.offset=-a,i.duration=a/+k})},c)};return ge(v),pe(v),be("pageshow",v),_e({reset:v}),ye(()=>[e.text,e.scrollable],v),()=>{const{color:p,wrapable:k,background:R}=e;return Z(x("div",{role:"alert",class:V({wrapable:k}),style:{color:p,background:R}},[f(),g(),m()]),[[Q,i.show]])}}});const Xe=Ce(De),D=he.create({});D.interceptors.request.use(e=>(e.headers["Content-Type"]="multipart/form-data;charset=UTF-8",e),e=>Promise.reject(e));D.interceptors.response.use(e=>{let t=e.data;return e.config.responseType==="blob"||typeof t=="string"&&(t=t&&JSON.parse(t)),t},e=>Promise.reject(e));const Je={video:{uploadAllVideos:e=>D.post("/api/upload",e),uploadVideo:e=>D.post("/api/infer",e),getAllVideos:e=>L.get("/api/list",e),getSelectVideo:e=>L.get("/api/getVideo",e),updateVideoTag:e=>L.put("/api/updateTag",e),deleteVideo:e=>L.delete("/api/deleteVideo",e),deleteVideoTag:e=>L.put("/api/deleteTag",null,e)},audio:{toText:e=>D.post("/api/audio2text",e)}},Me={key:0,style:{display:"flex","justify-content":"center",gap:"20vw","margin-top":"2vh"}},Oe={key:1,class:"control-panel"},Fe={__name:"ControlPanel",props:{isNecklace:{type:Boolean,default:!1}},emits:["add-video","start-recording","necklace-recording","upload"],setup(e,{emit:t}){const n=y(null),o=t,a=e,s=()=>{a.isNecklace&&o("necklace-recording")},u=we(()=>Re()),d=()=>{n.value.click()},i=f=>{const r=f.target.files[0];if(r){if(!r.type.includes("video")){w("请选择视频文件");return}o("add-video",r),n.value.value=null}};return(f,r)=>{const b=Ie,m=se,l=Ee;return B(),P(Te,null,[I(u)?(B(),P("div",Me,[x(b,{type:"primary",onClick:d},{default:C(()=>r[3]||(r[3]=[h("i",{class:"iconfont icon-shangchuan"},null,-1),E(" 视频选择 ")])),_:1,__:[3]}),x(b,{type:"warning",onClick:r[0]||(r[0]=g=>o("upload"))},{default:C(()=>r[4]||(r[4]=[h("i",{class:"iconfont icon-shangchuan1"},null,-1),E(" 一键上传 ")])),_:1,__:[4]})])):(B(),P("div",Oe,[x(m,{type:"primary",onClick:d},{default:C(()=>r[5]||(r[5]=[h("i",{class:"iconfont icon-shangchuan"},null,-1),E(" 选择本地视频 ")])),_:1,__:[5]}),x(l,{content:"将打开本机摄像头进行录制"},{default:C(()=>[x(m,{type:"success",onClick:r[1]||(r[1]=g=>o("start-recording"))},{default:C(()=>r[6]||(r[6]=[h("i",{class:"iconfont icon-luzhi"},null,-1),E(" 摄像头录制 ")])),_:1,__:[6]})]),_:1}),a.isNecklace?(B(),ae(m,{key:0,type:"info",onClick:s},{default:C(()=>r[7]||(r[7]=[h("i",{class:"iconfont icon-luzhi"},null,-1),E(" 项链录制 ")])),_:1,__:[7]})):F("",!0),x(m,{type:"warning",onClick:r[2]||(r[2]=g=>o("upload"))},{default:C(()=>r[8]||(r[8]=[h("i",{class:"iconfont icon-shangchuan1"},null,-1),E(" 一键上传 ")])),_:1,__:[8]})])),h("input",{type:"file",ref_key:"fileInput",ref:n,hidden:"",accept:"video/*",onChange:i},null,544)],64)}}},Ye=oe(Fe,[["__scopeId","data-v-3d494908"]]),Ge=e=>{switch(e.target.error.code){case e.target.error.MEDIA_ERR_ABORTED:w("视频加载被中止");break;case e.target.error.MEDIA_ERR_NETWORK:w("网络错误，无法加载视频");break;case e.target.error.MEDIA_ERR_DECODE:w("视频解码错误，可能是格式不支持");break;case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:w("视频格式不支持");break;default:w("未知错误")}},je={class:"camera-recorder"},ze={class:"controls"},qe={key:1},Ue={__name:"CameraRecorder",emits:["record-complete"],setup(e,{emit:t}){const n=y(null),o=y(null),a=y(!1),s=y(!1),u=y(0),d=y(null),i=y([]),f=y(!1),r=t;Ae(()=>b()),Be(()=>m());const b=()=>{navigator.mediaDevices.getUserMedia({video:!0}).then(c=>{n.value.srcObject=c,o.value=new MediaRecorder(c),o.value.ondataavailable=_=>i.value.push(_.data),o.value.onstop=()=>{const _=new Blob(i.value,{type:"video/x-msvideo"});r("record-complete",_,"avi"),i.value=[]},f.value=!0}).catch(c=>{c.name==="NotAllowedError"?(console.error("用户拒绝了权限请求"),w("用户拒绝了权限请求")):c.name==="NotFoundError"?(console.error("未找到摄像头"),w("未找到摄像头")):(console.error("无法访问摄像头:",c.message),w("无法访问摄像头:",c.message))})},m=()=>{var c;(c=o.value)!=null&&c.stream&&o.value.stream.getTracks().forEach(_=>_.stop())},l=()=>{a.value?s.value?p():v():g()},g=()=>{var c;f.value||b(),(c=o.value)!=null&&c.stream&&(o.value.start(),a.value=!0,s.value=!1,d.value=setInterval(()=>u.value++,1e3))},v=()=>{o.value&&(o.value.pause(),s.value=!0,clearInterval(d.value))},p=()=>{o.value&&(o.value.resume(),s.value=!1,d.value=setInterval(()=>u.value++,1e3))},k=()=>{o.value&&(o.value.stop(),clearInterval(d.value),a.value=!1,s.value=!1,u.value=0)},R=c=>{const _=Math.floor(c/60),T=c%60;return`${_}:${T.toString().padStart(2,"0")}`};return(c,_)=>{const T=se;return B(),P("div",je,[h("video",{ref_key:"videoElement",ref:n,autoplay:"",muted:""},null,512),h("div",ze,[x(T,{type:I(a)&&I(s)?"primary":"danger",onClick:l},{default:C(()=>[E(X(I(a)?I(s)?"继续录制":"暂停录制":"开始录制"),1)]),_:1},8,["type"]),I(a)?(B(),ae(T,{key:0,type:"danger",onClick:k},{default:C(()=>_[0]||(_[0]=[E(" 停止录制 ")])),_:1,__:[0]})):F("",!0),I(a)?(B(),P("span",qe,"  "+X(R(I(u))),1)):F("",!0)])])}}},He=oe(Ue,[["__scopeId","data-v-3cba7d9d"]]);export{Ye as C,Xe as N,He as a,Je as f,Ge as h,le as v};
