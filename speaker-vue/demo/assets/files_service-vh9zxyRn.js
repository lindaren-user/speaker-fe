import{d as A,e as N,c as L,y as p,a0 as O,c9 as Z,bZ as z,c1 as J,as as K,Z as X,aL as G,aM as H,b as u,bg as $,c3 as P,ca as j,cc as Q,bS as Y,w as ee,_ as F,a as te,j as ae,h as B,o as R,i as m,k as v,p as g,v as k,B as oe,s as U,aK as ne,F as se,C as W,a9 as le,aa as re,ak as ie,al as q,ao as D,cU as ce,cv as T}from"./index-CC-TFbUu.js";import"./el-tooltip-l0sNRNKZ.js";const[ue,x]=L("notice-bar"),de={text:String,mode:String,color:String,delay:N(1),speed:N(60),leftIcon:String,wrapable:Boolean,background:String,scrollable:{type:Boolean,default:null}};var fe=A({name:ue,props:de,emits:["close","replay"],setup(e,{emit:s,slots:l}){let a=0,n=0,r;const f=p(),d=p(),t=O({show:!0,offset:0,duration:0}),w=()=>{if(l["left-icon"])return l["left-icon"]();if(e.leftIcon)return u($,{class:x("left-icon"),name:e.leftIcon},null)},_=()=>{if(e.mode==="closeable")return"cross";if(e.mode==="link")return"arrow"},I=i=>{e.mode==="closeable"&&(t.show=!1,s("close",i))},C=()=>{if(l["right-icon"])return l["right-icon"]();const i=_();if(i)return u($,{name:i,class:x("right-icon"),onClick:I},null)},V=()=>{t.offset=a,t.duration=0,Y(()=>{j(()=>{t.offset=-n,t.duration=(n+a)/+e.speed,s("replay")})})},E=()=>{const i=e.scrollable===!1&&!e.wrapable,h={transform:t.offset?`translateX(${t.offset}px)`:"",transitionDuration:`${t.duration}s`};return u("div",{ref:f,role:"marquee",class:x("wrap")},[u("div",{ref:d,style:h,class:[x("content"),{"van-ellipsis":i}],onTransitionend:V},[l.default?l.default():e.text])])},y=()=>{const{delay:i,speed:h,scrollable:o}=e,c=Q(i)?+i*1e3:0;a=0,n=0,t.offset=0,t.duration=0,clearTimeout(r),r=setTimeout(()=>{if(!f.value||!d.value||o===!1)return;const b=P(f).width,M=P(d).width;(o||M>b)&&j(()=>{a=b,n=M,t.offset=-n,t.duration=n/+h})},c)};return Z(y),z(y),J("pageshow",y),K({reset:y}),X(()=>[e.text,e.scrollable],y),()=>{const{color:i,wrapable:h,background:o}=e;return G(u("div",{role:"alert",class:x({wrapable:h}),style:{color:i,background:o}},[w(),E(),C()]),[[H,t.show]])}}});const we=ee(fe),pe={key:0,style:{display:"flex","justify-content":"center",gap:"20vw","margin-top":"2vh"}},ve={key:1,class:"control-panel"},me={__name:"ControlPanel",emits:["add-video","start-recording","upload"],setup(e,{emit:s}){const l=s,a=te(()=>ae()),n=p(null),r=()=>{n.value.click()},f=d=>{const t=d.target.files[0];if(t){if(!t.type.includes("video")){W("请选择视频文件");return}l("add-video",t),n.value.value=null}};return(d,t)=>{const w=oe,_=U,I=ne;return R(),B(se,null,[v(a)?(R(),B("div",pe,[u(w,{type:"primary",onClick:r},{default:g(()=>t[3]||(t[3]=[m("i",{class:"iconfont icon-shangchuan"},null,-1),k(" 视频选择 ")])),_:1}),u(w,{type:"warning",onClick:t[0]||(t[0]=C=>l("upload"))},{default:g(()=>t[4]||(t[4]=[m("i",{class:"iconfont icon-shangchuan1"},null,-1),k(" 一键上传 ")])),_:1})])):(R(),B("div",ve,[u(_,{type:"primary",onClick:r},{default:g(()=>t[5]||(t[5]=[m("i",{class:"iconfont icon-shangchuan"},null,-1),k(" 选择本地视频 ")])),_:1}),u(I,{content:"将打开本机摄像头进行录制"},{default:g(()=>[u(_,{type:"success",onClick:t[1]||(t[1]=C=>l("start-recording"))},{default:g(()=>t[6]||(t[6]=[m("i",{class:"iconfont icon-luzhi"},null,-1),k(" 摄像头录制 ")])),_:1})]),_:1}),u(_,{type:"warning",onClick:t[2]||(t[2]=C=>l("upload"))},{default:g(()=>t[7]||(t[7]=[m("i",{class:"iconfont icon-shangchuan1"},null,-1),k(" 一键上传 ")])),_:1})])),m("input",{type:"file",ref_key:"fileInput",ref:n,hidden:"",accept:"video/*",onChange:f},null,544)],64)}}},Ce=F(me,[["__scopeId","data-v-f996a0fc"]]),ge={class:"camera-recorder"},_e={class:"controls"},ye={key:1},he={__name:"CameraRecorder",emits:["record-complete"],setup(e,{emit:s}){const l=p(null),a=p(null),n=p(!1),r=p(!1),f=p(0),d=p(null),t=p([]),w=s;le(()=>_()),re(()=>I());const _=()=>{navigator.mediaDevices.getUserMedia({video:!0}).then(o=>{l.value.srcObject=o,a.value=new MediaRecorder(o),a.value.ondataavailable=c=>t.value.push(c.data),a.value.onstop=()=>{const c=new Blob(t.value,{type:"video/x-msvideo"});w("record-complete",c),t.value=[]}}).catch(o=>{console.error("摄像头访问失败:",o),W("无法访问摄像头")})},I=()=>{var o;(o=a.value)!=null&&o.stream&&a.value.stream.getTracks().forEach(c=>c.stop())},C=()=>{n.value?r.value?y():E():V()},V=()=>{var o;(o=a.value)!=null&&o.stream&&(a.value.start(),n.value=!0,r.value=!1,d.value=setInterval(()=>f.value++,1e3))},E=()=>{a.value&&(a.value.pause(),r.value=!0,clearInterval(d.value))},y=()=>{a.value&&(a.value.resume(),r.value=!1,d.value=setInterval(()=>f.value++,1e3))},i=()=>{a.value&&(a.value.stop(),clearInterval(d.value),n.value=!1,r.value=!1,f.value=0)},h=o=>{const c=Math.floor(o/60),b=o%60;return`${c}:${b.toString().padStart(2,"0")}`};return(o,c)=>{const b=U;return R(),B("div",ge,[m("video",{ref_key:"videoElement",ref:l,autoplay:"",muted:""},null,512),m("div",_e,[u(b,{type:v(n)&&v(r)?"primary":"danger",onClick:C},{default:g(()=>[k(D(v(n)?v(r)?"继续录制":"暂停录制":"开始录制"),1)]),_:1},8,["type"]),v(n)?(R(),ie(b,{key:0,type:"danger",onClick:i},{default:g(()=>c[0]||(c[0]=[k(" 停止录制 ")])),_:1})):q("",!0),v(n)?(R(),B("span",ye,"  "+D(h(v(f))),1)):q("",!0)])])}}},Re=F(he,[["__scopeId","data-v-185a2f68"]]),S=ce.create({});S.interceptors.request.use(e=>(e.headers["Content-Type"]="multipart/form-data;charset=UTF-8",e),e=>Promise.reject(e));S.interceptors.response.use(e=>{let s=e.data;return e.config.responseType==="blob"||typeof s=="string"&&(s=s&&JSON.parse(s)),s},e=>Promise.reject(e));const Ie={video:{uploadAllVideos:e=>S.post("/api/upload",e),uploadVideo:e=>S.post("/api/infer",e),getAllVideos:e=>T.get("/api/list",e),getSelectVideo:e=>T.get("/api/getVideo",e),updateVideoTag:e=>T.put("/api/updateTag",e),deleteVideo:e=>T.delete("/api/deleteVideo",e),deleteVideoTag:e=>T.put("/api/deleteTag",null,e)},audio:{toText:e=>S.post("/api/audio2text",e)}};export{Ce as C,we as N,Re as a,Ie as f};
