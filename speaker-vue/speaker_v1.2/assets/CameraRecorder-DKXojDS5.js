import{Y as W,bV as M,aw as j,l as f,a2 as L,c6 as z,bU as J,b_ as K,ay as X,a0 as Y,aT as G,aU as H,e as u,bk as P,c0 as $,c7 as A,c9 as Q,bN as Z,aB as ee,c_ as te,cr as x,_ as U,b as ae,d as oe,c as N,o as I,a as g,u as m,w as _,i as w,B as ne,h as q,aS as se,F as re,n as v,ab as le,ac as ie,am as ce,an as O,aq as F}from"./index-Blj6vUit.js";import"./el-tooltip-l0sNRNKZ.js";const[ue,B]=j("notice-bar"),de={text:String,mode:String,color:String,delay:M(1),speed:M(60),leftIcon:String,wrapable:Boolean,background:String,scrollable:{type:Boolean,default:null}};var fe=W({name:ue,props:de,emits:["close","replay"],setup(e,{emit:s,slots:r}){let a=0,n=0,l;const p=f(),d=f(),t=L({show:!0,offset:0,duration:0}),b=()=>{if(r["left-icon"])return r["left-icon"]();if(e.leftIcon)return u(P,{class:B("left-icon"),name:e.leftIcon},null)},y=()=>{if(e.mode==="closeable")return"cross";if(e.mode==="link")return"arrow"},E=i=>{e.mode==="closeable"&&(t.show=!1,s("close",i))},C=()=>{if(r["right-icon"])return r["right-icon"]();const i=y();if(i)return u(P,{name:i,class:B("right-icon"),onClick:E},null)},V=()=>{t.offset=a,t.duration=0,Z(()=>{A(()=>{t.offset=-n,t.duration=(n+a)/+e.speed,s("replay")})})},D=()=>{const i=e.scrollable===!1&&!e.wrapable,R={transform:t.offset?`translateX(${t.offset}px)`:"",transitionDuration:`${t.duration}s`};return u("div",{ref:p,role:"marquee",class:B("wrap")},[u("div",{ref:d,style:R,class:[B("content"),{"van-ellipsis":i}],onTransitionend:V},[r.default?r.default():e.text])])},h=()=>{const{delay:i,speed:R,scrollable:T}=e,o=Q(i)?+i*1e3:0;a=0,n=0,t.offset=0,t.duration=0,clearTimeout(l),l=setTimeout(()=>{if(!p.value||!d.value||T===!1)return;const c=$(p).width,k=$(d).width;(T||k>c)&&A(()=>{a=c,n=k,t.offset=-n,t.duration=n/+R})},o)};return z(h),J(h),K("pageshow",h),X({reset:h}),Y(()=>[e.text,e.scrollable],h),()=>{const{color:i,wrapable:R,background:T}=e;return G(u("div",{role:"alert",class:B({wrapable:R}),style:{color:i,background:T}},[b(),D(),C()]),[[H,t.show]])}}});const ke=ee(fe),S=te.create({});S.interceptors.request.use(e=>(e.headers["Content-Type"]="multipart/form-data;charset=UTF-8",e),e=>Promise.reject(e));S.interceptors.response.use(e=>{let s=e.data;return e.config.responseType==="blob"||typeof s=="string"&&(s=s&&JSON.parse(s)),s},e=>Promise.reject(e));const we={video:{uploadAllVideos:e=>S.post("/api/upload",e),uploadVideo:e=>S.post("/api/infer",e),getAllVideos:e=>x.get("/api/list",e),getSelectVideo:e=>x.get("/api/getVideo",e),updateVideoTag:e=>x.put("/api/updateTag",e),deleteVideo:e=>x.delete("/api/deleteVideo",e),deleteVideoTag:e=>x.put("/api/deleteTag",null,e)},audio:{toText:e=>S.post("/api/audio2text",e)}},pe={key:0,style:{display:"flex","justify-content":"center",gap:"20vw","margin-top":"2vh"}},ve={key:1,class:"control-panel"},me={__name:"ControlPanel",emits:["add-video","start-recording","upload"],setup(e,{emit:s}){const r=f(null),a=s,n=ae(()=>oe()),l=()=>{r.value.click()},p=d=>{const t=d.target.files[0];if(t){if(!t.type.includes("video")){v("请选择视频文件");return}a("add-video",t),r.value.value=null}};return(d,t)=>{const b=ne,y=q,E=se;return I(),N(re,null,[m(n)?(I(),N("div",pe,[u(b,{type:"primary",onClick:l},{default:_(()=>t[3]||(t[3]=[g("i",{class:"iconfont icon-shangchuan"},null,-1),w(" 视频选择 ")])),_:1}),u(b,{type:"warning",onClick:t[0]||(t[0]=C=>a("upload"))},{default:_(()=>t[4]||(t[4]=[g("i",{class:"iconfont icon-shangchuan1"},null,-1),w(" 一键上传 ")])),_:1})])):(I(),N("div",ve,[u(y,{type:"primary",onClick:l},{default:_(()=>t[5]||(t[5]=[g("i",{class:"iconfont icon-shangchuan"},null,-1),w(" 选择本地视频 ")])),_:1}),u(E,{content:"将打开本机摄像头进行录制"},{default:_(()=>[u(y,{type:"success",onClick:t[1]||(t[1]=C=>a("start-recording"))},{default:_(()=>t[6]||(t[6]=[g("i",{class:"iconfont icon-luzhi"},null,-1),w(" 摄像头录制 ")])),_:1})]),_:1}),u(y,{type:"warning",onClick:t[2]||(t[2]=C=>a("upload"))},{default:_(()=>t[7]||(t[7]=[g("i",{class:"iconfont icon-shangchuan1"},null,-1),w(" 一键上传 ")])),_:1})])),g("input",{type:"file",ref_key:"fileInput",ref:r,hidden:"",accept:"video/*",onChange:p},null,544)],64)}}},Ee=U(me,[["__scopeId","data-v-a7de84b2"]]),Ce=e=>{switch(e.target.error.code){case e.target.error.MEDIA_ERR_ABORTED:v("视频加载被中止");break;case e.target.error.MEDIA_ERR_NETWORK:v("网络错误，无法加载视频");break;case e.target.error.MEDIA_ERR_DECODE:v("视频解码错误，可能是格式不支持");break;case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:v("视频格式不支持");break;default:v("未知错误")}},ge={class:"camera-recorder"},_e={class:"controls"},be={key:1},ye={__name:"CameraRecorder",emits:["record-complete"],setup(e,{emit:s}){const r=f(null),a=f(null),n=f(!1),l=f(!1),p=f(0),d=f(null),t=f([]),b=f(!1),y=s;le(()=>E()),ie(()=>C());const E=()=>{navigator.mediaDevices.getUserMedia({video:!0}).then(o=>{r.value.srcObject=o,a.value=new MediaRecorder(o),a.value.ondataavailable=c=>t.value.push(c.data),a.value.onstop=()=>{const c=new Blob(t.value,{type:"video/x-msvideo"});y("record-complete",c),t.value=[]},b.value=!0}).catch(o=>{o.name==="NotAllowedError"?(console.error("用户拒绝了权限请求"),v("用户拒绝了权限请求")):o.name==="NotFoundError"?(console.error("未找到摄像头"),v("未找到摄像头")):(console.error("无法访问摄像头:",o.message),v("无法访问摄像头:",o.message))})},C=()=>{var o;(o=a.value)!=null&&o.stream&&a.value.stream.getTracks().forEach(c=>c.stop())},V=()=>{n.value?l.value?i():h():D()},D=()=>{var o;b.value||E(),(o=a.value)!=null&&o.stream&&(a.value.start(),n.value=!0,l.value=!1,d.value=setInterval(()=>p.value++,1e3))},h=()=>{a.value&&(a.value.pause(),l.value=!0,clearInterval(d.value))},i=()=>{a.value&&(a.value.resume(),l.value=!1,d.value=setInterval(()=>p.value++,1e3))},R=()=>{a.value&&(a.value.stop(),clearInterval(d.value),n.value=!1,l.value=!1,p.value=0)},T=o=>{const c=Math.floor(o/60),k=o%60;return`${c}:${k.toString().padStart(2,"0")}`};return(o,c)=>{const k=q;return I(),N("div",ge,[g("video",{ref_key:"videoElement",ref:r,autoplay:"",muted:""},null,512),g("div",_e,[u(k,{type:m(n)&&m(l)?"primary":"danger",onClick:V},{default:_(()=>[w(F(m(n)?m(l)?"继续录制":"暂停录制":"开始录制"),1)]),_:1},8,["type"]),m(n)?(I(),ce(k,{key:0,type:"danger",onClick:R},{default:_(()=>c[0]||(c[0]=[w(" 停止录制 ")])),_:1})):O("",!0),m(n)?(I(),N("span",be,"  "+F(T(m(p))),1)):O("",!0)])])}}},Te=U(ye,[["__scopeId","data-v-bd224269"]]);export{Ee as C,ke as N,Te as a,we as f,Ce as h};
